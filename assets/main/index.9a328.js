window.__require=function t(e,o,r){function n(c,s){if(!o[c]){if(!e[c]){var p=c.split("/");if(p=p[p.length-1],!e[p]){var u="function"==typeof __require&&__require;if(!s&&u)return u(p,!0);if(i)return i(p,!0);throw new Error("Cannot find module '"+c+"'")}c=p}var l=o[c]={exports:{}};e[c][0].call(l.exports,function(t){return n(e[c][1][t]||t)},l,l.exports,t,e,o,r)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<r.length;c++)n(r[c]);return n}({Board:[function(t,e,o){"use strict";cc._RF.push(e,"3e1cbq8X3pObbBny5p/14Qw","Board");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./constants/config"),s=t("./utils/getNewPositionByStep"),p=cc._decorator,u=p.ccclass,l=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.board=new Array(c.default.BOARD_WIDTH).fill(null).map(function(){return new Array(c.default.BOARD_HEIGHT).fill(null)}),e.onBubbleClick=function(){},e}return n(e,t),e.prototype.initGame=function(t,e){console.log("INIT",t),this.initStep(),this.bubblePrefab=t,this.onBubbleClick=e,this.createBoard()},e.prototype.clear=function(){for(var t,e=0;e<c.default.BOARD_WIDTH;e++)for(var o=0;o<c.default.BOARD_HEIGHT;o++){var r=null===(t=this.board[e])||void 0===t?void 0:t[o];r&&r.isValid&&r.destroy()}this.board=new Array(c.default.BOARD_WIDTH).fill(null).map(function(){return new Array(c.default.BOARD_HEIGHT).fill(null)})},e.prototype.createBoard=function(){for(var t=c.default.BOARD_HEIGHT,e=c.default.BOARD_WIDTH,o=0;o<e;o++)for(var r=0;r<t;r++){var n=this.createBubble(cc.v2(o,r));this.board[o][r]=n}console.log("board",this.board)},e.prototype.createBubble=function(t){var e=cc.instantiate(this.bubblePrefab),o=e.getComponent("Bubble"),r=s.getNewPositionByStep(t,this.stepX,this.stepY);return o.initType(),o.initCoord(t),o.initSize(this.stepX>this.stepY?.8*this.stepY:.8*this.stepX),o.setBubblePosition(r),e.on("bubble-click",this.handleBubbleClick,this),this.node.addChild(e),e},e.prototype.getGroupToRemove=function(t){var e=this,o=this.board[t.x][t.y];if(o){var r=o.getComponent("Bubble"),n=new Set,i=[],s=function(t){if(console.log("pos"),!(t.x<0||t.y<0||t.x>=c.default.BOARD_WIDTH||t.y>=c.default.BOARD_HEIGHT)){var o=t.x+","+t.y;if(!n.has(o)){var p=e.board[t.x][t.y];p&&p.getComponent("Bubble").type===r.type&&(n.add(o),i.push(p),s(cc.v2(t.x+1,t.y)),s(cc.v2(t.x-1,t.y)),s(cc.v2(t.x,t.y+1)),s(cc.v2(t.x,t.y-1)))}}};return s(t),i}},e.prototype.removeGroup=function(t){if(t.length<2)return 0;for(var e=0;e<t.length;e++){var o=t[e].getComponent("Bubble");this.board[o.coord.x][o.coord.y]=null,o.bubbleDestroy(e)}return this.fillEmptySpace(t.length),t.length},e.prototype.fillEmptySpace=function(t){for(var e=0;e<c.default.BOARD_WIDTH;e++){for(var o=0,r=0;r<c.default.BOARD_HEIGHT;r++){var n=this.board[e][r];if(n){if(!(n&&o>0))continue;var i=n.getComponent("Bubble"),p=s.getNewPositionByStep(cc.v2(e,r-o),this.stepX,this.stepY);i.moveToPosition(p,t),i.initCoord(cc.v2(e,r-o)),this.board[e][r-o]=n,this.board[e][r]=null}else o++}for(var u=0;u<o;u++){var l=this.createBubble(cc.v2(e,c.default.BOARD_HEIGHT));(i=l.getComponent("Bubble")).initCoord(cc.v2(e,c.default.BOARD_HEIGHT-o+u)),this.board[e][c.default.BOARD_HEIGHT-o+u]=l,p=s.getNewPositionByStep(cc.v2(e,c.default.BOARD_HEIGHT-o+u),this.stepX,this.stepY),i.moveToPosition(p,t+2*u)}}},e.prototype.handleBubbleClick=function(t){this.onBubbleClick(t)},e.prototype.initStep=function(){this.stepX=(this.node.width-2*c.default.BOARD_SIZE)/c.default.BOARD_WIDTH,this.stepY=(this.node.height-2*c.default.BOARD_SIZE)/c.default.BOARD_HEIGHT},i([u],e)}(cc.Component));o.default=l,cc._RF.pop()},{"./constants/config":"config","./utils/getNewPositionByStep":"getNewPositionByStep"}],Bubble:[function(t,e,o){"use strict";cc._RF.push(e,"7e8c49UTsFKjL5kxek7bnbo","Bubble");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./constants/bubbleSpriteFrame"),s=t("./utils/getRandomType"),p=cc._decorator,u=p.ccclass,l=p.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bubbleSprites=new c.BubbleSpriteSet,e.destroySound=null,e.type="block_blue",e}return n(e,t),e.prototype.start=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onClick,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onKeyDown,this)},e.prototype.initType=function(t){if(this.sprite=this.getComponent(cc.Sprite),t)this.type=t,this.sprite.spriteFrame=this.bubbleSprites[t];else{var e=s.getRandomType();this.type=e;var o=this.bubbleSprites[e];this.sprite.spriteFrame=o}},e.prototype.initSize=function(t){this.size=t,this.node.setScale(t/100,t/100)},e.prototype.initCoord=function(t){this.coord=t},e.prototype.onClick=function(){this.node.emit("bubble-click",this.coord)},e.prototype.onKeyDown=function(){cc.audioEngine.playEffect(this.destroySound,!1),console.log("KEY_DOWN"),this.getComponent(cc.Animation).play("bubble_touch")},e.prototype.setBubblePosition=function(t){this.node.setPosition(t)},e.prototype.moveToPosition=function(t,e){var o=this;setTimeout(function(){var e=cc.moveTo(.5,t);o.node.runAction(e)},100*e)},e.prototype.bubbleDestroy=function(t){var e=this;console.log("delay",t);var o=setTimeout(function(){t>0&&cc.audioEngine.playEffect(e.destroySound,!1),e.getComponent(cc.Animation).play("bubble_destroy"),clearTimeout(o);var r=setTimeout(function(){e.node.destroy(),clearTimeout(r)},200)},100*t)},i([l(c.BubbleSpriteSet)],e.prototype,"bubbleSprites",void 0),i([l(cc.AudioClip)],e.prototype,"destroySound",void 0),i([u],e)}(cc.Component);o.default=a,cc._RF.pop()},{"./constants/bubbleSpriteFrame":"bubbleSpriteFrame","./utils/getRandomType":"getRandomType"}],GameController:[function(t,e,o){"use strict";cc._RF.push(e,"e0a21fZEL5JnLtrCHdBZ72Z","GameController");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,p=c.property,u=t("./constants/config"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boardNode=null,e.bubblePrefab=null,e.board=null,e.timer=null,e.score=null,e.gameOver=null,e}return n(e,t),e.prototype.start=function(){this.init(),this.startGame()},e.prototype.init=function(){this.board=this.boardNode.getComponent("Board"),this.timer=this.timeScoreBoardNode.getComponent("Timer"),this.score=this.timeScoreBoardNode.getComponent("Score"),this.gameOver=this.gameOverNode.getComponent("GameOverView"),this.gameOverNode.on("restart_game",this.restartGame,this)},e.prototype.startGame=function(){console.log("START_GAME"),this.board.initGame(this.bubblePrefab,this.handleBubbleClick.bind(this)),this.timer.initTimer(u.default.GAME_TIME,this.timeUp.bind(this),1),this.score.initScore(u.default.START_SCORE)},e.prototype.handleBubbleClick=function(t){var e=this.board.getGroupToRemove(t),o=this.board.removeGroup(e);this.calculateTimeAndScore(o)},e.prototype.timeUp=function(){console.log("\u0412\u0420\u0415\u041c\u042f \u0412\u042b\u0428\u041b\u041e"),this.gameOver.showGameOver()},e.prototype.restartGame=function(){this.board.clear(),this.startGame(),this.gameOver.hideGameOver()},e.prototype.calculateTimeAndScore=function(t){this.score.updateScore(100*t),this.timer.addTime(t)},i([p(cc.Node)],e.prototype,"boardNode",void 0),i([p(cc.Prefab)],e.prototype,"bubblePrefab",void 0),i([p(cc.Node)],e.prototype,"timeScoreBoardNode",void 0),i([p(cc.Node)],e.prototype,"gameOverNode",void 0),i([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./constants/config":"config"}],GameOverView:[function(t,e,o){"use strict";cc._RF.push(e,"4ea51V/qj5Jc4ispnPTgJIR","GameOverView");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.start=function(){this.restartButton.on(cc.Node.EventType.TOUCH_END,this.onRestartButtonClick,this)},e.prototype.showGameOver=function(){var t=cc.moveTo(.5,cc.v2(this.node.position.x,this.node.position.y-this.node.height));this.node.runAction(t)},e.prototype.hideGameOver=function(){var t=cc.moveTo(.5,cc.v2(this.node.position.x,this.node.position.y+this.node.height));this.node.runAction(t)},e.prototype.onRestartButtonClick=function(){this.node.emit("restart_game")},i([p(cc.Node)],e.prototype,"restartButton",void 0),i([p(cc.Node)],e.prototype,"gameOverView",void 0),i([s],e)}(cc.Component);o.default=u,cc._RF.pop()},{}],Score:[function(t,e,o){"use strict";cc._RF.push(e,"f5bbe9s9ZlCmKLnmD8xJed5","Score");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,p=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.score=0,e.timeScoreView=null,e}return n(e,t),e.prototype.start=function(){this.timeScoreView=this.node.getComponent("TimerScoreView")},e.prototype.initScore=function(t){this.score=t,this.timeScoreView.renderScore(this.score)},e.prototype.updateScore=function(t){this.score=this.score+t,this.timeScoreView.renderScore(this.score)},i([s],e)}(cc.Component));o.default=p,cc._RF.pop()},{}],TimerScoreView:[function(t,e,o){"use strict";cc._RF.push(e,"29e31yv/gdPW5UgVl4XsSiq","TimerScoreView");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.renderTime=function(t){this.timerLabel.string=""+t},e.prototype.renderScore=function(t){this.scoreLabel.string=""+t},i([p(cc.Label)],e.prototype,"timerLabel",void 0),i([p(cc.Label)],e.prototype,"scoreLabel",void 0),i([s],e)}(cc.Component);o.default=u,cc._RF.pop()},{}],Timer:[function(t,e,o){"use strict";cc._RF.push(e,"009b2SI9YpL5q7ZCRE+yiJp","Timer");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,s=c.ccclass,p=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allTimes=0,e.step=1,e.isWork=!1,e.onTimeUp=function(){},e.second=0,e.timerScoreView=null,e}return n(e,t),e.prototype.start=function(){this.timerScoreView=this.node.getComponent("TimerScoreView"),this.timerScoreView.renderTime(this.allTimes)},e.prototype.initTimer=function(t,e,o){this.onTimeUp=e,this.allTimes=t,this.step=o,this.isWork=!0},e.prototype.addTime=function(t){this.allTimes=this.allTimes+t},e.prototype.update=function(t){this.isWork&&(this.second+=t,this.second>1&&(this.second=0,this.round()))},e.prototype.round=function(){this.allTimes=this.allTimes-this.step,this.timerScoreView.renderTime(this.allTimes),this.allTimes<1&&(this.isWork=!1,this.onTimeUp())},i([s],e)}(cc.Component));o.default=p,cc._RF.pop()},{}],bubbleSpriteFrame:[function(t,e,o){"use strict";cc._RF.push(e,"d78c6V5YVdCtpBVqfsLGgkc","bubbleSpriteFrame");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.BubbleSpriteSet=void 0;var n=cc._decorator,i=n.ccclass,c=n.property,s=function(){function t(){this.block_green=null,this.block_blue=null,this.block_purpure=null,this.block_yellow=null,this.block_red=null}return t.prototype.get=function(t){return this[t]},r([c({type:cc.SpriteFrame})],t.prototype,"block_green",void 0),r([c({type:cc.SpriteFrame})],t.prototype,"block_blue",void 0),r([c({type:cc.SpriteFrame})],t.prototype,"block_purpure",void 0),r([c({type:cc.SpriteFrame})],t.prototype,"block_yellow",void 0),r([c({type:cc.SpriteFrame})],t.prototype,"block_red",void 0),r([i("BubbleSpriteSet")],t)}();o.BubbleSpriteSet=s,cc._RF.pop()},{}],config:[function(t,e,o){"use strict";cc._RF.push(e,"38116N6Ug9PPadqkiCbseFz","config"),Object.defineProperty(o,"__esModule",{value:!0}),o.default={BOARD_WIDTH:8,BOARD_HEIGHT:8,BOARD_SIZE:40,GAME_TIME:3,START_SCORE:0},cc._RF.pop()},{}],getNewPositionByStep:[function(t,e,o){"use strict";cc._RF.push(e,"f38cfG/QL9AVpi7TIBTBdw5","getNewPositionByStep"),Object.defineProperty(o,"__esModule",{value:!0}),o.getNewPositionByStep=void 0;var r=t("../constants/config");o.getNewPositionByStep=function(t,e,o){return cc.v2(t.x*e+e/2+r.default.BOARD_SIZE,t.y*o+o/2+r.default.BOARD_SIZE)},cc._RF.pop()},{"../constants/config":"config"}],getRandomType:[function(t,e,o){"use strict";cc._RF.push(e,"21aedAZ1kdAKo0Ueq9jCDTj","getRandomType"),Object.defineProperty(o,"__esModule",{value:!0}),o.getRandomType=void 0;var r={1:"block_blue",2:"block_green",3:"block_purpure",4:"block_red",5:"block_yellow"};o.getRandomType=function(){var t=Math.floor(5*Math.random())+1;return r[t]},cc._RF.pop()},{}],types:[function(t,e){"use strict";cc._RF.push(e,"5b49dr1McxCHo6gLnsQllpg","types"),cc._RF.pop()},{}]},{},["Board","Bubble","GameController","GameOverView","Score","Timer","TimerScoreView","bubbleSpriteFrame","config","types","getNewPositionByStep","getRandomType"]);